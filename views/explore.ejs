<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Explore</title>
    <link href="https://fonts.googleapis.com/css?family=Monoton|Ultra" rel="stylesheet"> 
    <link href="https://fonts.googleapis.com/css?family=Katibeh" rel="stylesheet">
   
    <link href="https://fonts.googleapis.com/css?family=Vidaloka" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <link rel="stylesheet" href="/style.css">
         <style>
           *{
             margin: 0;
             padding: 0;
           }
           body{
             
             font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif"
           }
           nav{
             background-color: rgba(255, 255, 255, 0.911);
             box-shadow:0px 0px 20px #dddddd; 
           }
           section#header{
             padding-top: 10vh;
            
             min-height: 35vh;
           }
           @media screen and (max-width: 600px){
             .brand-logo{
               font-size: 0.1rem;
             }
           }
         </style>
</head>
<body style="background-color:rgba(212, 212, 212, 0.342);">
  <!--dropdown-->
<ul id="dropdown1" class="dropdown-content">
   
    <li><a href="/profile">Profile</a></li>
    <li><a href="/upload/write">Write</a></li>
    <li class="divider"></li>
    <li><a href="/auth/logout">Logout</a></li>
  </ul>
<!--Nav Bar-->
    <nav class="grey-text text-darken-4 hoverable pushpin navbar-fixed" style="z-index: 10;">
        <div class="nav-wrapper container ">
                              
          <a href="/" class="brand-logo black-text text-darken-4 " style="font-family: 'Monoton', cursive; ">Echo <span class="grey-text text-lighten-3" style="font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif"" >|</span><span class=" grey-text text-darken-3 right" style="font-family: 'Katibeh', cursive; padding-top: 0.4rem;">  Blogs</span></a>
          <a href="" class="sidenav-trigger" data-target="mobile-links" >
            <i class="material-icons grey-text text-darken-3" style="font-size:34px;">menu</i>
        </a>
       <ul id="nav-mobile" class="right hide-on-med-and-down grey-text text-darken-4">
                <% if(!user){ %>
        <li ><a href="/" class="grey-text text-darken-4">Home</a></li>
        <%}%>
        <li class="active"><a href="/explore"class="grey-text text-darken-4" >Explore</a></li>
      <% if(!user){ %>
        <li><a href="/auth/login" class="grey-text text-darken-4">Login</a></li>
      <%} else{%>
          <li><a class="dropdown-trigger" data-target="dropdown1" style="padding-top: 10px;"><img src="<%=user.thumbnail%>" class="circle" style="height:35px; width:35px;" ><i class="material-icons right">arrow_drop_down</i></a></li>
          <%}%>
      </ul>
        
      </div>
          
      </nav>
    <ul class="sidenav" id="mobile-links">
    <% if(!user){ %>
      <li ><a href="/" class="grey-text text-darken-4">Home</a></li>
      <li><a href="/auth/login" class="grey-text text-darken-4">Login</a></li>
      <li class="active"><a href="/explore"class="grey-text text-darken-4" >Explore</a></li>
      
    <%} else{%>
        <li><a><img src="<%=user.thumbnail%>" class="circle " ></a></li>
        <li><a href="/profile">Profile</a></li>
        <li class="active"><a href="/explore"class="grey-text text-darken-4" >Explore</a></li>
        <li><a href="/upload/write">Write</a></li>
        <li class="divider"></li>
        <li><a href="/auth/logout">Logout</a></li>

        <%}%>
    </ul>
              
            
    <!--end-->

<!--welcome message-->
<section class="section row  center container "style="margin-top:15vh;" >
        <div class="col s12  center container" >
                    
          <img src="/img/brightmind.png" style="height:64px;" >
          
          <img src="/img/physics.png" style="height:64px;"  >
              <img src="/img/mindmap.png" style="height:64px;" >         
        </div>
        <div class="col s12 grey-text text-darken-2 container" >
        <h5 style="font-weight:bold;">Amazing ideas waiting to be discovered</h5>
        </div>
    </section>

    <section  id="main-section">
        <!--tabs-->
        <div class="row container ">
               <div  class="col s12  card-panel white" style="min-height:40vh;padding:1% 2% 4% 2%;" > 
                                            
                   <div class="">     
                       <ul class="tabs " style="font-size: 2rem; font-weight: bold; box-shadow:0px 2px 0px rgb(211, 210, 210) ;">
                         <li class="tab col s6 center">
                             <a href="#trending" class="teal-text text-darken-3">Blogs</a>
                         </li>
                          <li class="tab col s6 center">
                                  <a href="#search" class="teal-text text-darken-3">Search</a>
                          </li>
                     </ul>
                     <div class="col s12 center" id="trending" >
                      <%if(typeof(blogs)!='undefined' && blogs.length){%>
                            <div class="row">
                              <%blogs.forEach((blog)=>{%>
                                  <div class="col s12 m4" id="blog">
                                    
                                      <div class="card  hoverable small">
                                          <div class="card-image">
                                              <a href="/display/display-blog/<%=blog._id%>" class="blogTrigger  ">
                                              <img src="/uploads/<%=blog.bigPic.filename%>" class="responsive-img" style="opacity:0.4;">
                                              <span class="card-title">
                                                  <h5 class="truncate black-text"  style="font-weight:bold;">      
                                                  <%=blog.title%>
                                                  </h5 >    
                                                  </span>
                                                </a>
                                          </div>
                                          
                                          <div class="card-content">
                                              
                                          <div class=" valign-wrapper" id="author">
  
                                                      <ul class="collection" style="border:none; margin-bottom: 0;">
                                                          <li class="collection-item avatar">
                                                              <img src="<%=blog.profilepic%>" class="circle ">
                                                      <p><span  class="title grey-text text-darken-3"><%=blog.author%></span> <span></span></p> 
                                                      <p><span class="grey-text text-lighten-1"><%=blog.date%></span> </p>
                                                          
                                                    </li>
                                                    </ul>
                                                
                                              </div> 
                                          </div>
                                      </div>
                                  </div>
                            <%})%>               
                       </div>
                       <%}else{%>
                        <div class="center" style="padding-top:10%;">
                          <img src="/img/emp-list.png" alt="">
                          <p class="grey-text " style="padding-top:2%;">Uh Oh! No blogs posted so far.</p>
                      </div>
                        <%}%>    
                     </div>
                         <div class="col s12" id="search">
                           <!--Search bar begins-->
                           <div id="searchbar" class="grey lighten-4 ">
                             
                              <a class="teal-text text-darken-2 modal-trigger waves-effect" href="#modal1" style="font-size:initial; font-weight:initial; border:1px teal solid; border-radius:5px; padding:4px 6px; margin: 6px 4px; ">Search<i class="material-icons teal-text">youtube_search</i></a>
                              <span class="grey-text ">Find posts that suits your taste</span>
                              <!-- Modal Structure -->
  <div id="modal1" class="modal">
      <div class="modal-content">
          <div class="row">
              <form>
                  <div class="row">
                  <!--full width of its parent tag-->
                  <div class="input-field col s6 m6 l6">
                     <i class="material-icons prefix teal-text text-darken-2">tag</i>
                     <select multiple name="tags" id="searchbytags">
                      
                       <option value="Science">Science</option>
                       <option value="Culture">Culture</option>
                       <option value="Politics">Politics</option>
                       <option value="Technical">Technical</option>
                       <option value="Social">Social</option>
                       <option value="Arts">Arts</option>
                       <option value="Story">Story</option>
                     </select>
                     <label>Search on the basis of tags</label>
                   </div>
                  
                       <div class="input-field col s6 m6 l6">
                           <i class="material-icons prefix teal-text text-darken-2">library_books</i>
                           <input name="blogname" type="text" class="validate" placeholder="Search by blog name" id="searchbyblog">
                           <label for="blogname"></label>
                         </div>
                         <div class="input-field col s8 m6 l6">
                             <i class="material-icons prefix teal-text">face</i>
                             <input name="authorname" type="text" class="validate" placeholder="Search by author name" id="searchbyauthor">
                             <label for="authorname"></label>
                           </div>
                           <div class="input-field col s12 m6 l6 center">
                               
                               <a id="submit-search" class="modal-close btn teal-text waves-effect white text-darken-2" style="border:1px teal solid; border-radius:5px;">Search </a>
                               
                             </div>
                         </div>
                         </form>
                  
                </div>
      </div>
      <div class="modal-footer">
          
        <a href="#!" class="modal-close waves-effect waves-green btn-flat">Back</a>
      </div>
    </div>
    <!---->
                             
</div>
<!--search bar ends-->
<div id="search-results-length" class="grey lighten-3 grey-text text-darken-2"></div>
<div id="search-results-area">
<%if(typeof(resultblogs)!='undefined'){%>
<div>
  <span>Showing Results : </span><%=resultblogs.length%><span> results</span>
  <div class="divider"></div>
</div>
<div id="seach-results">
    <div class="row">
        <%resultblogs.forEach((resultblog)=>{%>
          <%if(resultblog){%>
              <div class="col s12 m4" id="blog">
                      <div class="card  hoverable small">
                          <div class="card-image">
                              <a href="/display/display-blog/<%=resultblog._id%>" class="blogTrigger  ">
                              <img src="/uploads/<%=resultblog.bigPic.filename%>" class="responsive-img" style="opacity:0.4;">
                              <span class="card-title">
                                  <h5 class="truncate black-text"  style="font-weight:bold;">
                                      
                                  <%=resultblog.title%>
                                  
                                  </h5 >
                                      
                                  </span>
                                </a>
                          </div>
                          
                          <div class="card-content">
                              <div class=" valign-wrapper" id="author">   
                                <ul class="collection" style="border:none; margin-bottom: 0;">
                                    <li class="collection-item avatar">
                                        <img src="<%=resultblog.profilepic%>" class="circle ">
                                <p><span  class="title grey-text text-darken-3"><%=resultblog.author%></span> <span><a class="teal-text waves-effect right" style="border:1px teal solid; border-radius:5px; padding:1px 6px;">Follow</a></span></p> 
                                <p><span class="grey-text text-lighten-1"><%=resultblog.date%></span> </p>
                                    
                              </li>
                              </ul>
                            </div>
                                    
                          </div>
                      </div>
                  </div>
                  <%}%>
                  <%})%>
              </div>
                  </div>
              <%}%>
                  </div>
            
                </div>
  
                 </div>
        </div>
       
   </div>
</section>
   
    <!--Footer-->
   
    <footer class="page-footer  grey  darken-4 " style="margin-top:4rem;">
       
      <div class="container">
          <div class="row">
            <div class="col l6 s12 m6">
              <h5 class="white-text">Echo Blogs</h5>
              <p class="grey-text text-lighten-1 left">Lorem, ipsum dolor sit amet consectetur adipisicing elit. Minima consectetur maiores repellat magni fuga aspernatur! Lorem ipsum dolor sit amet consectetur.</p>
            </div>
            <div class="col l4 offset-l2 s12 m6">
              <h5 class="white-text">Connect With Us</h5>
              <ul >
                <li><a class="grey-text text-lighten-1" href="#!">Facebook</a></li>
                <li><a class="grey-text text-lighten-1" href="#!">Twitter</a></li>
                <li><a class="grey-text text-lighten-1" href="#!">Linkedin</a></li>
                
              </ul>
            </div>
          </div>
        </div>
        <div class="footer-copyright black">
          <div class="container center">
          Â© 2019 Echo Inc | All rights reserved
          
          </div>
        </div>
      </footer>
      <!--End-->

    <!--script-->
      <script>
        window.onload=()=>{
          let searchSubmit=document.getElementById("submit-search");
          searchSubmit.onclick=()=>{
            let searchbyauthor="authorname="+document.getElementById('searchbyauthor').value;
            let searchbyblog="&blogname="+document.getElementById('searchbyblog').value;
            let searchoptions=document.querySelectorAll("#searchbytags option");
            let searchbytags=[];
            searchoptions.forEach((option)=>{
              if(option.selected){
                searchbytags.push(option.value);
              }
            })
          let searchbytagsstring=searchbytags.join("&tags=");
          console.log('http://localhost:3000/explore/searchposts/'+searchbyauthor+searchbyblog+"&tags="+searchbytagsstring);
            let xml=new XMLHttpRequest()
            xml.open("GET",'http://localhost:3000/explore/searchposts/?'+searchbyauthor+searchbyblog+"&tags="+searchbytagsstring,true);
            xml.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xml.onreadystatechange=()=>{
              if(xml.readyState==4&&xml.status==200){
                let searchresponse=JSON.parse(xml.responseText);
                let search_results_area=document.getElementById('search-results-area');
                let search_results_length=document.getElementById('search-results-length');
                search_results_length.innerHTML='Showing Results :'+searchresponse.length+" result(s)";
                searchresponse.forEach((resultblog)=>{
                  let searchhtml=`  <div class="col s12 m4" id="blog">
                                                             
                    <div class="card  hoverable small">
                        <div class="card-image">
                            <a href="/display/display-blog/${resultblog._id}" class="blogTrigger  ">
                            <img src="/uploads/${resultblog.bigPic.filename}" class="responsive-img" style="opacity:0.4;">
                            <span class="card-title">
                                <h5 class="truncate black-text"  style="font-weight:bold;">
                                  
                              ${resultblog.title}
                                </h5 > 
                                </span>
                              </a>
                        </div>
                        <div class="card-content">  
                          <div class=" valign-wrapper" id="author">
                            <ul class="collection" style="border:none; margin-bottom: 0;">
                                <li class="collection-item avatar">
                                    <img src="${resultblog.profilepic}" class="circle ">
                          <p><span  class="title grey-text text-darken-3">${resultblog.author}</span></p> 
                            <p><span class="grey-text text-lighten-1">${resultblog.date}</span> </p>
                              
                          </li>
                          </ul>
                    
                        </div>
                          
                        </div>
                    </div>
                </div>`
                search_results_area.innerHTML+=searchhtml;
                })
              }
            }

            xml.send();
          }
        }
  
      </script>


    <script>
 document.addEventListener('DOMContentLoaded', function() {
    var elems = document.querySelectorAll('select');
    var instances = M.FormSelect.init(elems, {});
  });
    document.addEventListener('DOMContentLoaded', function() {
      var elems = document.querySelectorAll('.pushpin');
      var instances = M.Pushpin.init(elems,{});
      var el=document.querySelectorAll(".tabs");

          var instance = M.Tabs.init(el,{});
    });
    document.addEventListener('DOMContentLoaded', function() {
    var elems = document.querySelectorAll('.modal');
    var instances = M.Modal.init(elems, {});
    
  });
  document.addEventListener('DOMContentLoaded', function() {
    var elems = document.querySelectorAll('.sidenav');
    var instances = M.Sidenav.init(elems, {});
    
  
  });
  document.addEventListener('DOMContentLoaded', function() {
    var elems = document.querySelectorAll('.tooltipped');
    var instances = M.Tooltip.init(elems, {});
  });
  document.addEventListener('DOMContentLoaded', function() {
    var elems = document.querySelectorAll('.dropdown-trigger');
    var instances = M.Dropdown.init(elems, {});
  });
  document.addEventListener('DOMContentLoaded', function() {
    var elems = document.querySelectorAll('.fixed-action-btn');
    var instances = M.FloatingActionButton.init(elems, {
      direction: 'top',
      hoverEnabled: false
    });
  });
  </script>
</body>
</html>